const fs = require('fs');
const path = require('path');

const assetsDir = path.join(__dirname, '../src/assets/images');
const outputFile = path.join(__dirname, '../src/utils/imageAssets.ts');

const imagesToEncode = [
  'lars.png', 
  'MCHT-logo.png', 
  'chatgpt-image.png',
  'mand2-225x300.png',
  'mand1-225x300.png',
  'kvinde2-226x300.png',
  'kvinde1-224x300.png'
];

console.log('Generating base64 assets...');

const base64Map = {};

imagesToEncode.forEach(filename => {
  const filePath = path.join(assetsDir, filename);
  if (fs.existsSync(filePath)) {
    const data = fs.readFileSync(filePath);
    const base64 = data.toString('base64');
    base64Map[filename] = base64;
    console.log(`✓ Encoded ${filename} (${(base64.length / 1024).toFixed(1)}KB)`);
  } else {
    console.warn(`⚠ File not found: ${filename}`);
  }
});

const output = `/**
 * Base64-encoded local images for WebView
 * Auto-generated by scripts/generate-base64-assets.js
 * DO NOT EDIT MANUALLY
 */

export const base64Images: Record<string, string> = ${JSON.stringify(base64Map, null, 2)};

// Helper to get data URL from base64
export const getDataUrl = (key: string): string | null => {
  const base64 = base64Images[key];
  if (!base64) return null;
  
  // Detect image type from base64 signature
  const isPNG = base64.startsWith('iVBORw0KGgo');
  const isJPEG = base64.startsWith('/9j/');
  
  const mimeType = isPNG ? 'image/png' : isJPEG ? 'image/jpeg' : 'image/png';
  return \`data:\${mimeType};base64,\${base64}\`;
};
`;

fs.writeFileSync(outputFile, output);
console.log(`\n✓ Generated ${outputFile}`);
console.log(`  Total size: ${(output.length / 1024).toFixed(1)}KB`);