<h1>REFLECTIONS DEBUG TEST</h1>

<div id="debug" style="background:#000;color:#0f0;padding:10px;font-family:monospace;font-size:12px;margin-bottom:20px;max-height:200px;overflow:auto"></div>

<div id="list"></div>

<script>
function log(msg){
  var d=document.getElementById('debug');
  var t=new Date().toTimeString().split(' ')[0];
  d.innerHTML+='['+t+'] '+msg+'<br>';
  d.scrollTop=d.scrollHeight;
  console.log('[DEBUG]',msg);
}

log('Script loaded');
log('ReactNativeWebView: '+(window.ReactNativeWebView?'YES':'NO'));

function handle(e){
  log('Message received: '+e.data.substring(0,100));
  try{
    var m=JSON.parse(e.data);
    log('Parsed type: '+m.type);
    if(m.type==='REFLECTIONS'){
      log('Items count: '+(m.payload.items?m.payload.items.length:0));
      var l=document.getElementById('list');
      if(!m.payload.items||m.payload.items.length===0){
        l.innerHTML='<p style="padding:20px;color:#999">Ingen refleksioner</p>';
        log('No items - showing empty');
        return;
      }
      var h='';
      m.payload.items.forEach(function(r,i){
        log('Item '+i+': '+r.id);
        var d={};
        try{d=JSON.parse(r.text)}catch(x){log('Parse error item '+i)}
        h+='<div style="border:2px solid #ddd;padding:15px;margin:10px 0;border-radius:8px"><b>'+r.id+'</b><br>Q1: '+(d.q1||'?')+'</div>';
      });
      l.innerHTML=h;
      log('Displayed '+m.payload.items.length+' items');
    }
  }catch(err){
    log('ERROR: '+err.message);
  }
}

window.addEventListener('message',handle);
document.addEventListener('message',handle);

log('Listeners added');

setTimeout(function(){
  log('Requesting reflections...');
  if(window.ReactNativeWebView){
    window.ReactNativeWebView.postMessage(JSON.stringify({type:'GET_REFLECTIONS',payload:{}}));
    log('GET_REFLECTIONS sent');
  }else{
    log('ERROR: No ReactNativeWebView');
  }
},500);
</script>
